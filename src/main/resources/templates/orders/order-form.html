<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>주문하기</title>
  <link rel="stylesheet" th:href="@{/css/main.css}" />
  <link rel="stylesheet" th:href="@{/css/order.css}" />
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  
</head>
<body>
  <div th:replace="~{fragments/index-header :: header}"></div>

<section class="order-container">
  <!-- 왼쪽 영역: 주문상품 + 배송정보 -->
<form th:action="@{/order}" method="post" style="display: flex; gap: 40px;">
  <div class="order-left">
    <div class="order-items">
      <!-- 주문 상품 정보 -->
      <!-- 반복문으로 장바구니 아이템들 보여줄 때 -->
      <div th:each="item, itemStat : ${cartItems}" class="item">
      <!-- 실제 보여지는 상품 정보 -->
      <img th:src="@{${item.product.imageUrl}}" width="80" height="80" />
      <div class="item-info">
          <div th:text="${item.product.name}">상품명</div>
          <div th:text="${item.product.price} + '원'">가격</div>
          <div th:text="'수량: ' + ${item.quantity}">수량</div>
      </div>

      <!-- ✅ 반드시 포함해야 할 숨겨진 input 필드 -->
      <input type="hidden" th:name="|items[${itemStat.index}].productId|" th:value="${item.product.id}" />
      <input type="hidden" th:name="|items[${itemStat.index}].quantity|" th:value="${item.quantity}" />
      </div>
    </div>
    <!-- 배송 정보 -->
    <div class="delivery-info">
      <h2>배송 정보</h2>
      <div class="input-row">
        <input type="text" name="receiverName" placeholder="수령인" />
        <input type="text" name="phone" placeholder="연락처" />
      </div>
      <div class="input-row">
        <input type="text" name="zipcode" placeholder="우편번호" />
        <button type="button" onclick="execDaumPostcode()" class="btn-find-address">주소찾기</button>
      </div>
      <input type="text" name="address" placeholder="주소" />
      <input type="text" name="addressDetail" placeholder="상세주소" />
      <select name="memo">
        <option disabled selected>배송메모를 선택해주세요.</option>
        <option>문 앞에 놓아주세요</option>
        <option>직접 수령할게요</option>
        <option>경비실에 맡겨주세요</option>
        <option>연락 후 배송해주세요</option>
      </select>
    </div>
  </div>

  <!-- 오른쪽 영역: 결제 요약 -->
  <div class="order-summary1">
    <label>쿠폰</label>
    <input type="text" disabled />
    <label>포인트</label>
    <input type="text" disabled />
    <div class="total-price-row">
      <span >총 결제 금액:</span>
      <span id="totalPrice" th:text="${#numbers.formatInteger(totalPrice, 0)} + '원'">0원</span>
    </div>
      <button class="checkout-btn" type="submit">결제하기</button>
  </div>
</form>
</section>
  <script th:src="@{/js/main.js}" defer></script>
  <script th:src="@{/js/order.js}" defer></script>
  <script th:src="@{/js/header.js}" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>
